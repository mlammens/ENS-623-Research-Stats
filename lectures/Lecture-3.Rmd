---
title: "Meeting 3 - R Programming"
author: "Matthew E. Aiello-Lammens"
date: '2020-02-12'
output:
  html_document:
    code_folding: hide
    toc: yes
---

# Today's Goals







***

# Reading in your own data

One of the most basic things you will need to do in R is read in your own data set. 
You can read in Excel files, simple text files, and even files from Google Sheets.
But the easiest type of file to read in is a comma seperated values (CSV) file. 
You can save an Excel workbook (or Numbers workbook or Google Sheet) as a CSV file by using the "Save as ..." menu item. 

For today, we're going to work with a data set related to gastropod fecundity.
First, download the file here - [gastropod data](https://mlammens.github.io/ENS-623-Research-Stats/data/Logan_Examples/Chapter6/Data/ward.csv) **The download will begin when you press the hyperlink! The file is called `ward.csv`.**

Once you've downloaded the file, move it to the `data` subfolder in your `ENS-623-Research-Stats` folder.

### Differences in fecundity of intertidal gastropods in two different intertidal zones (Example 6A in Logan, Box 3.1 in Q&K)

Ward and Quinn (1988) investigated the differences in fecundity of *Lepsiella vinosa* in two different intertidal zones (mussel zone and littorinid zone). 

Let's read in the data and have a quick look

```{r, eval=FALSE}
gastro <- read.csv(file = "~/Dropbox/Pace/Teaching/ENS-623-Research-Stats/ENS-623-Research-Stats-Web/data/Logan_Examples/Chapter6/Data/ward.csv")
summary(gastro)
```


```{r, echo=FALSE}
gastro <- read.csv(file = "https://mlammens.github.io/ENS-623-Research-Stats/data/Logan_Examples/Chapter6/Data/ward.csv")
summary(gastro)
```





***

# R Programming

## User Defined Functions

What is a function?

Why write a function?

**Example**

*Note:* the example below is borrowed from the [Software Carpentry](https://software-carpentry.org/) Introduction to Programming materials.

Convert from Fahrenheit to Kelvin

```{r}
fahr_to_kelvin <- function(temp) {
  kelvin <- ((temp - 32) * (5 / 9)) + 273.15
  return(kelvin)
}
```

Convert from Kelvin to Celsius

```{r}
kelvin_to_celsius <- function(temp) {
  celsius <- temp - 273.15
  return(celsius)
}
```

#### Challenge

Write a function to convert from Fahrenheit to Celsius.


## `for` loops

How do I do the same thing many times?

### Generic for loop

```
for (variable in collection) {
  do things with variable
}
```

Let's get more specific. Say we took a bunch of measurements of temperature in Fahrenheit, but want to convert them. How might we do it?

#### Make our temperature data set

```{r}
set.seed(8)
temp_data <- runif(n = 20, min = -5, max = 5) + 45
```

#### Challenge

What did we just do?


#### Aside: Resetting the `seed` so the numbers are random again

To reset your seed, you can execute the following command:

```{r}
rm(.Random.seed, envir=globalenv())
```


### Use our `fahr_to_kelvin` function on each element

Iteration 1.

```{r}
for( x in temp_data){
  fahr_to_kelvin(x)
}
```

Iteration 2. By element

```{r}
for( x in temp_data){
  print(fahr_to_kelvin(x))
}
```

Iteration 3. By element location

```{r}
for( x in 1:length(temp_data)){
  print(fahr_to_kelvin(temp_data[x]))
}
```

Iteration 4. By element locatoin with output in a new vector

```{r}
temp_data_kelvin <- vector()
for( x in 1:length(temp_data)){
  temp_data_kelvin[x] <- fahr_to_kelvin(temp_data[x])
}

print(temp_data_kelvin)
```

***

#### Challenge

Write a **function** that uses a `for` loop to calculate the mean of a vector of numbers.

Recall that the mean is:

$$
\bar{x} = \frac{\sum_{i=1}^n{x_i}}{n}
$$

Compare the results of your function with that of the `mean` function in base R.

***

## Conditionals

We can use conditional statements to **control the flow** of our code, and to "make choices" as it progresses.

### `if` and `else`

The `if` and `else` statements are key to making choices in your code.
Before understanding `if`/`else` statements, we need to review **booleans** - i.e., `TRUE` and `FALSE`

#### Aside: `TRUE` and `FALSE` values

```{r}
TRUE
```

```{r}
20 == 20
```

```{r}
20 > 40
```

A `!` sign can be used as a logical negation

```{r}
!(20 > 40)
```

There are many logical operators to consider.

***

#### Challenge Describe what each fo the following operators are doing.

```{r}
x <- TRUE
y <- FALSE
```

```{r}
x & y
```

```{r}
x | y
```

```{r}
xy <- c(x,y)
```

```{r}
any(xy)
```

```{r}
all(xy)
```

***

Now that we know a bit about booleans, let's get into `if`/`else` statements.

Essentially, an `if` is a conditional that says, "do this thing after the `if` statement, ***if*** the conditional was TRUE."

Here's a simple example (taken from Software Carpentry's lessons)

```{r}
num <- 37
if (num > 100) {
  print("greater than 100")
} else {
  print("not greater than 100")
}
```

#### Challenge 

Re-define `num` so you get the other option.

We don't need an `else` statement for this to work -

```{r}
num <- 37
if (num > 100) {
  print("The number was greater than 100")
}

```

We can also write a "cascade" of `if`/`else` statements

```{r}
if (num > 0) {
  return(1)
} else if (num == 0) {
  return(0)
} else {
  return(-1)
}
```

#### Challenge

Make the above into a function, that takes in any value, and returns whether it is positive, negative, or equal to 0.

***

### `while` loops

`while` loops are not necessarily as common as `for` loops introduced in class Wednesday, but they are quite important. 
One key difference between `for` loops and `while` loops is that the former is usually set to repeat a given number of times, while the later repeats until some condition is met.
Incidentally, this also means it's easy to get into an [infinite loop](https://en.wikipedia.org/wiki/Infinite_loop) when writing `while` loops. Be careful!

Here is a basic `while` loop.

```{r}
foo <- 0
while(foo < 10){
  print(foo)
  foo <- foo + 1
}
```



# Writing Pseudocode

When faced with a problem such as that in [Problem Set 3](http://mlammens.github.io/Biostats/lectures/Lecture-3.html), I will often write out the flow of my simulation before I start coding. 
This is called [pseudocode](https://en.wikipedia.org/wiki/Pseudocode) in computer programing.
In this problemset I would probably write out the pseudocode in several steps.

## Number of coin flips it takes to get to 100 heads


Imagine you are flipping a fair coin (i.e., there is a 0.5 chance of getting a heads and a 0.5 chance of getting a tails).
You want to continue flipping the coin *until* you get 100 heads.
**Write a script that simulates coin flips, and counts the number of times you need to flip the coin until you get 100 heads.**
Note that since the coin flip is a random process, it will not necessarily take you the same number of flips if you re-run the script.


